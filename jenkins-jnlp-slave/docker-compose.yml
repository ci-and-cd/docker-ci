
version: '2.1'
services:
  jenkins-jnlp-slave:
    build:
      context: .
      dockerfile: Dockerfile
    image: home1oss/jenkins-jnlp-slave:2.62-bionic
    restart: always

    container_name: ${JENKINS_SLAVE_DOMAIN:-jenkins-jnlp-slave}.${INFRASTRUCTURE:-local}
    hostname: ${JENKINS_SLAVE_DOMAIN:-jenkins-jnlp-slave}.${INFRASTRUCTURE:-local}
    #external_links:
    #- jenkins.${INFRASTRUCTURE:-local}:jenkins.${INFRASTRUCTURE:-local}
    #- nexus.${INFRASTRUCTURE:-local}:nexus.${INFRASTRUCTURE:-local}
    #- mvnsite.${INFRASTRUCTURE:-local}:mvnsite.${INFRASTRUCTURE:-local}
    volumes:
    - volume-jenkins-jnlp-slave:/home/jenkins/.jenkins
    - /var/run/docker.sock:/var/run/docker.sock
    environment:
    - INFRASTRUCTURE_CONF_GIT_TOKEN=${INFRASTRUCTURE_CONF_GIT_TOKEN:-your_INFRASTRUCTURE_CONF_GIT_TOKEN}
    #- JENKINS_URL=http://jenkins.local:8080 <secret> <slave_name>
    #- JENKINS_URL=http://jenkins.local:8080/computer/<slave_name>/slave-agent.jnlp -jnlpCredentials <username>:<token>
    - JENKINS_URL=${JENKINS_URL}

volumes:
  volume-jenkins-jnlp-slave: {}

networks:
  default:
    external:
      name: oss-network
